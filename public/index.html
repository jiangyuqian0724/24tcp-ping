<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCP Ping Monitor - 24/7 网络监控</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <circle cx="16" cy="16" r="14" stroke="url(#gradient)" stroke-width="2" />
                        <circle cx="16" cy="16" r="6" fill="url(#gradient)" />
                        <defs>
                            <linearGradient id="gradient" x1="0" y1="0" x2="32" y2="32">
                                <stop offset="0%" stop-color="#667eea" />
                                <stop offset="100%" stop-color="#764ba2" />
                            </linearGradient>
                        </defs>
                    </svg>
                    <h1>TCP Ping Monitor</h1>
                </div>
                <div class="header-actions" style="display: flex; gap: 1rem; align-items: center;">
                    <button id="settingsBtn" class="btn btn-secondary btn-sm" onclick="openSettingsModal()"
                        title="系统设置">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path
                                d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        系统设置
                    </button>
                    <div class="connection-status">
                        <span class="status-dot" id="wsStatus"></span>
                        <span id="wsStatusText">连接中...</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Add Monitor Form -->
        <section class="add-monitor-section">
            <div class="card">
                <h2>添加新监控</h2>
                <form id="addMonitorForm" class="monitor-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="host">主机地址</label>
                            <input type="text" id="host" placeholder="例如: google.com, 8.8.8.8 或 2001:4860:4860::8888"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="port">端口</label>
                            <input type="number" id="port" placeholder="例如: 80" min="1" max="65535" required>
                        </div>
                        <div class="form-group">
                            <label for="interval">检测间隔 (秒)</label>
                            <input type="number" id="interval" placeholder="1" min="1" value="1">
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" />
                                </svg>
                                添加监控
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </section>

        <!-- Monitors Grid -->
        <section class="monitors-section">
            <div class="section-header">
                <h2>监控列表</h2>
                <div class="stats-summary" id="statsSummary">
                    <div class="stat-item">
                        <span class="stat-label">总数</span>
                        <span class="stat-value" id="totalMonitors">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">在线</span>
                        <span class="stat-value online" id="onlineMonitors">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">离线</span>
                        <span class="stat-value offline" id="offlineMonitors">0</span>
                    </div>
                </div>
            </div>
            <div id="monitorsGrid" class="monitors-grid">
                <div class="empty-state">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                        <circle cx="32" cy="32" r="30" stroke="#e0e7ff" stroke-width="2" />
                        <path d="M32 20V44M20 32H44" stroke="#a5b4fc" stroke-width="2" stroke-linecap="round" />
                    </svg>
                    <p>暂无监控项目</p>
                    <p class="empty-hint">请在上方添加新的监控目标</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Monitor Card Template -->
    <template id="monitorCardTemplate">
        <div class="monitor-card" data-id="">
            <div class="monitor-header">
                <div class="monitor-info">
                    <h3 class="monitor-title"></h3>
                    <span class="monitor-status"></span>
                </div>
                <div class="monitor-actions">
                    <button class="btn-icon" data-action="details" title="查看详情">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path
                                d="M2 6H14M2 10H14M4 2H12C13.1 2 14 2.9 14 4V12C14 13.1 13.1 14 12 14H4C2.9 14 2 13.1 2 12V4C2 2.9 2.9 2 4 2Z"
                                stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                        </svg>
                    </button>
                    <button class="btn-icon" data-action="edit" title="修改参数">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M11 2L14 5L5 14H2V11L11 2Z" stroke="currentColor" stroke-width="1.5"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>
                    <button class="btn-icon" data-action="toggle" title="启动/停止">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path class="play-icon" d="M4 2L12 8L4 14V2Z" fill="currentColor" />
                            <path class="pause-icon" d="M4 2H6V14H4V2ZM10 2H12V14H10V2Z" fill="currentColor"
                                style="display:none" />
                        </svg>
                    </button>
                    <button class="btn-icon btn-danger" data-action="delete" title="删除">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M3 4H13M5 4V3H11V4M6 7V11M10 7V11M4 4L5 13H11L12 4" stroke="currentColor"
                                stroke-width="1.5" stroke-linecap="round" />
                        </svg>
                    </button>
                </div>
            </div>

            <div class="monitor-stats">
                <div class="stat-box">
                    <div class="stat-label">延迟</div>
                    <div class="stat-value latency-value">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">成功率</div>
                    <div class="stat-value success-rate">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">平均延迟</div>
                    <div class="stat-value avg-latency">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">总检测</div>
                    <div class="stat-value total-pings">-</div>
                </div>
            </div>

            <div class="monitor-chart">
                <canvas class="latency-chart"></canvas>
            </div>

            <div class="monitor-footer">
                <span class="last-check">最后检测: -</span>
                <span class="uptime-badge">运行时间: <span class="uptime-value">-</span></span>
            </div>
        </div>
    </template>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>修改监控</h2>
                <button class="modal-close" onclick="closeEditModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="editMonitorForm" class="monitor-form"
                    style="display: flex; flex-direction: column; gap: 1.5rem;">
                    <div class="form-group">
                        <label>主机地址</label>
                        <input type="text" id="editHost" disabled
                            style="background: var(--bg-secondary); cursor: not-allowed;">
                        <small
                            style="color: var(--text-muted); margin-top: 0.5rem; display: block;">主机和端口不支持修改，如需更改请删除后重建</small>
                    </div>
                    <div class="form-group">
                        <label>端口</label>
                        <input type="number" id="editPort" disabled
                            style="background: var(--bg-secondary); cursor: not-allowed;">
                    </div>
                    <div class="form-group">
                        <label for="editInterval">检测间隔 (秒)</label>
                        <input type="number" id="editInterval" min="1" required>
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">保存修改</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Details Modal -->
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">监控详情</h2>
                <button class="modal-close" onclick="closeDetailsModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <div class="time-filter">
                    <div class="filter-group">
                        <button class="filter-btn active" data-range="all">全部</button>
                        <button class="filter-btn" data-range="10m">10分钟</button>
                        <button class="filter-btn" data-range="30m">30分钟</button>
                        <button class="filter-btn" data-range="1h">1小时</button>
                        <button class="filter-btn" data-range="6h">6小时</button>
                        <button class="filter-btn" data-range="24h">24小时</button>
                        <button class="filter-btn" data-range="7d">7天</button>
                        <button class="filter-btn" data-range="30d">30天</button>
                    </div>
                    <button id="exportCsvBtn" class="btn btn-secondary btn-sm" onclick="exportToCSV()"
                        title="导出当前视图数据为 CSV">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="margin-right: 4px;">
                            <path
                                d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15M7 10L12 15M12 15L17 10M12 15V3"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        导出 CSV
                    </button>
                </div>

                <div class="details-stats">
                    <div class="detail-stat-card">
                        <div class="detail-stat-label">总检测次数</div>
                        <div class="detail-stat-value" id="detailTotalPings">-</div>
                    </div>
                    <div class="detail-stat-card">
                        <div class="detail-stat-label">成功次数</div>
                        <div class="detail-stat-value success" id="detailSuccessPings">-</div>
                    </div>
                    <div class="detail-stat-card">
                        <div class="detail-stat-label">失败次数</div>
                        <div class="detail-stat-value error" id="detailFailedPings">-</div>
                    </div>
                    <div class="detail-stat-card">
                        <div class="detail-stat-label">平均延迟</div>
                        <div class="detail-stat-value" id="detailAvgLatency">-</div>
                    </div>
                    <div class="detail-stat-card">
                        <div class="detail-stat-label">最小延迟</div>
                        <div class="detail-stat-value" id="detailMinLatency">-</div>
                    </div>
                    <div class="detail-stat-card">
                        <div class="detail-stat-label">最大延迟</div>
                        <div class="detail-stat-value" id="detailMaxLatency">-</div>
                    </div>
                </div>

                <!-- Trend Chart -->
                <div class="trend-chart-section">
                    <h3>延迟趋势图</h3>
                    <div class="chart-wrapper">
                        <canvas id="detailChart"></canvas>
                    </div>
                </div>

                <div class="history-section">
                    <h3>历史记录 <span id="historyCount" class="history-count"></span></h3>
                    <div class="table-container">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>时间</th>
                                    <th>状态</th>
                                    <th>延迟</th>
                                    <th>错误信息</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody">
                                <tr>
                                    <td colspan="4" class="loading">加载中...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>系统设置</h2>
                <button class="modal-close" onclick="closeSettingsModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="settingsForm" class="monitor-form"
                    style="display: flex; flex-direction: column; gap: 1.5rem;">
                    <div class="form-group">
                        <label for="pingTimeout">默认检测超时 (毫秒)</label>
                        <input type="number" id="pingTimeout" min="500" step="100" required>
                        <small style="color: var(--text-muted); margin-top: 0.5rem; display: block;">单次 Ping 的最大等待时间，建议
                            1000-5000ms</small>
                    </div>
                    <div class="form-group">
                        <label for="maxHistory">历史记录上限 (条/监控)</label>
                        <input type="number" id="maxHistory" min="0" max="10000" step="100" required>
                        <small style="color: var(--text-muted); margin-top: 0.5rem; display: block;">每个监控项目保留的最大记录数。设置为
                            0 表示无限制存储。</small>
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">确认保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>